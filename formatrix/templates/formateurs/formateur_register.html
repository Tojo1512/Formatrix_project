{% extends "base.html" %}
{% load static %}

{% block title %}Inscription Formateur - Formatrix{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/theme.css' %}">
<link rel="stylesheet" href="{% static 'css/forms.css' %}">
<style>
  .form-step {
    display: none;
  }
  .form-step.active {
    display: block;
  }
  .step-indicator {
    display: flex;
    justify-content: space-between;
    margin-bottom: 2rem;
    position: relative;
  }
  .step-indicator::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 2px;
    background: #ccc;
    z-index: 1;
  }
  .step {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: #ccc;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: white;
    position: relative;
    z-index: 2;
  }
  .step.active {
    background-color: var(--primary-color);
  }
  .step.completed {
    background-color: var(--success-color);
  }
  .step-title {
    position: absolute;
    top: 45px;
    font-size: 0.8rem;
    color: #666;
    white-space: nowrap;
  }
  .step.active .step-title {
    color: var(--primary-color);
    font-weight: bold;
  }
  .step.completed .step-title {
    color: var(--success-color);
  }
  .form-navigation {
    display: flex;
    justify-content: space-between;
    margin-top: 2rem;
  }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
  <div class="form-header">
    <h2 class="form-title">
      <i class="fas fa-user-plus"></i>
      Inscription Formateur
    </h2>
    <a href="{% url 'home' %}" class="btn btn-outline">
      <i class="fas fa-arrow-left"></i>
      Retour
    </a>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div class="alert {% if message.tags == 'error' %}alert-danger{% else %}alert-{{ message.tags }}{% endif %} mb-4">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  {% if form.non_field_errors %}
    <div class="alert alert-danger">
      {% for error in form.non_field_errors %}
        {{ error }}
      {% endfor %}
    </div>
  {% endif %}

  <!-- Indicateur d'étapes -->
  <div class="step-indicator">
    <div class="step active" id="step-indicator-1">
      1
      <span class="step-title">Compte</span>
    </div>
    <div class="step" id="step-indicator-2">
      2
      <span class="step-title">Informations personnelles</span>
    </div>
    <div class="step" id="step-indicator-3">
      3
      <span class="step-title">Informations professionnelles</span>
    </div>
    <div class="step" id="step-indicator-4">
      4
      <span class="step-title">Documents</span>
    </div>
  </div>

  <form method="post" enctype="multipart/form-data" novalidate id="formateur-form">
    {% csrf_token %}
    
    <!-- Étape 1: Création du compte -->
    <div class="form-step active" id="step-1">
      <div class="form-section">
        <h3 class="section-title">
          <i class="fas fa-user-lock"></i>
          Création du compte
        </h3>
        
        <div class="form-row">
          <div class="form-group {% if form.username.errors %}has-error{% endif %}">
            <label class="form-label" for="{{ form.username.id_for_label }}">
              <i class="fas fa-user"></i>
              Nom d'utilisateur
            </label>
            {{ form.username }}
            {% include "includes/field_errors.html" with field=form.username %}
          </div>

          <div class="form-group {% if form.email.errors %}has-error{% endif %}">
            <label class="form-label" for="{{ form.email.id_for_label }}">
              <i class="fas fa-envelope"></i>
              Email
            </label>
            {{ form.email }}
            {% include "includes/field_errors.html" with field=form.email %}
          </div>
        </div>

        <div class="form-row">
          <div class="form-group {% if form.password1.errors %}has-error{% endif %}">
            <label class="form-label" for="{{ form.password1.id_for_label }}">
              <i class="fas fa-lock"></i>
              Mot de passe
            </label>
            {{ form.password1 }}
            {% include "includes/field_errors.html" with field=form.password1 %}
          </div>

          <div class="form-group {% if form.password2.errors %}has-error{% endif %}">
            <label class="form-label" for="{{ form.password2.id_for_label }}">
              <i class="fas fa-lock"></i>
              Confirmer le mot de passe
            </label>
            {{ form.password2 }}
            {% include "includes/field_errors.html" with field=form.password2 %}
          </div>
        </div>
      </div>

      <div class="form-navigation">
        <button type="button" class="btn btn-outline">
          <i class="fas fa-times"></i>
          Annuler
        </button>
        <button type="button" class="btn btn-primary next-step" data-next="2">
          Suivant
          <i class="fas fa-arrow-right"></i>
        </button>
      </div>
    </div>

    <!-- Étape 2: Informations personnelles -->
    <div class="form-step" id="step-2">
      <div class="form-section">
        <h3 class="section-title">
          <i class="fas fa-user"></i>
          Informations personnelles
        </h3>
        
        <div class="form-row">
          <div class="form-group {% if form.nom.errors %}has-error{% endif %}">
            <label class="form-label" for="{{ form.nom.id_for_label }}">
              <i class="fas fa-user"></i>
              Nom
            </label>
            {{ form.nom }}
            {% include "includes/field_errors.html" with field=form.nom %}
          </div>

          <div class="form-group {% if form.prenom.errors %}has-error{% endif %}">
            <label class="form-label" for="{{ form.prenom.id_for_label }}">
              <i class="fas fa-user"></i>
              Prénom
            </label>
            {{ form.prenom }}
            {% include "includes/field_errors.html" with field=form.prenom %}
          </div>
        </div>

        <div class="form-row">
          <div class="form-group {% if form.telephone.errors %}has-error{% endif %}">
            <label class="form-label" for="{{ form.telephone.id_for_label }}">
              <i class="fas fa-phone"></i>
              Téléphone
            </label>
            {{ form.telephone }}
            {% include "includes/field_errors.html" with field=form.telephone %}
          </div>

          <div class="form-group {% if form.date_naissance.errors %}has-error{% endif %}">
            <label class="form-label" for="{{ form.date_naissance.id_for_label }}">
              <i class="fas fa-calendar"></i>
              Date de naissance
            </label>
            {{ form.date_naissance }}
            {% include "includes/field_errors.html" with field=form.date_naissance %}
          </div>
        </div>

        <div class="form-row">
          <div class="form-group {% if form.ville.errors %}has-error{% endif %}">
            <label class="form-label" for="{{ form.ville.id_for_label }}">
              <i class="fas fa-city"></i>
              Ville
            </label>
            {{ form.ville }}
            {% include "includes/field_errors.html" with field=form.ville %}
          </div>

          <div class="form-group {% if form.adresse.errors %}has-error{% endif %}">
            <label class="form-label" for="{{ form.adresse.id_for_label }}">
              <i class="fas fa-map-marker-alt"></i>
              Adresse
            </label>
            {{ form.adresse }}
            {% include "includes/field_errors.html" with field=form.adresse %}
          </div>
        </div>
      </div>

      <div class="form-navigation">
        <button type="button" class="btn btn-outline prev-step" data-prev="1">
          <i class="fas fa-arrow-left"></i>
          Précédent
        </button>
        <button type="button" class="btn btn-primary next-step" data-next="3">
          Suivant
          <i class="fas fa-arrow-right"></i>
        </button>
      </div>
    </div>

    <!-- Étape 3: Informations professionnelles -->
    <div class="form-step" id="step-3">
      <div class="form-section">
        <h3 class="section-title">
          <i class="fas fa-briefcase"></i>
          Informations professionnelles
        </h3>
        
        <div class="form-row">
          <div class="form-group {% if form.type_formateur.errors %}has-error{% endif %}">
            <label class="form-label" for="{{ form.type_formateur.id_for_label }}">
              <i class="fas fa-tag"></i>
              Type de formateur
            </label>
            {{ form.type_formateur }}
            {% include "includes/field_errors.html" with field=form.type_formateur %}
          </div>

          <div class="form-group {% if form.niveau_expertise.errors %}has-error{% endif %}">
            <label class="form-label" for="{{ form.niveau_expertise.id_for_label }}">
              <i class="fas fa-layer-group"></i>
              Niveau d'expertise
            </label>
            {{ form.niveau_expertise }}
            {% include "includes/field_errors.html" with field=form.niveau_expertise %}
          </div>
        </div>

        <div class="form-row">
          <div class="form-group {% if form.specialites.errors %}has-error{% endif %}">
            <label class="form-label" for="{{ form.specialites.id_for_label }}">
              <i class="fas fa-star"></i>
              Spécialités
            </label>
            {{ form.specialites }}
            {% include "includes/field_errors.html" with field=form.specialites %}
          </div>
        </div>

        <div class="form-group {% if form.disponibilite.errors %}has-error{% endif %}">
          <label class="form-label" for="{{ form.disponibilite.id_for_label }}">
            <i class="fas fa-clock"></i>
            Disponibilité
          </label>
          {{ form.disponibilite }}
          {% include "includes/field_errors.html" with field=form.disponibilite %}
          <small class="form-text text-muted">
            Précisez vos horaires de disponibilité
          </small>
        </div>
      </div>

      <div class="form-navigation">
        <button type="button" class="btn btn-outline prev-step" data-prev="2">
          <i class="fas fa-arrow-left"></i>
          Précédent
        </button>
        <button type="button" class="btn btn-primary next-step" data-next="4">
          Suivant
          <i class="fas fa-arrow-right"></i>
        </button>
      </div>
    </div>

    <!-- Étape 4: Documents -->
    <div class="form-step" id="step-4">
      <div class="form-section">
        <h3 class="section-title">
          <i class="fas fa-book"></i>
          Documents
        </h3>
        
        <div class="form-row">
          <div class="form-group {% if form.cv.errors %}has-error{% endif %}">
            <label class="form-label" for="{{ form.cv.id_for_label }}">
              <i class="fas fa-file-pdf"></i>
              CV
            </label>
            <div class="file-upload-container">
              <div class="file-upload-box" id="cv-upload-box">
                <i class="fas fa-file-upload upload-icon"></i>
                <div class="upload-text">
                  <span class="primary-text">Glissez votre CV ici</span>
                  <span class="secondary-text">ou cliquez pour sélectionner un fichier</span>
                </div>
                <div class="file-info" id="cv-file-info">
                  <i class="fas fa-file-pdf file-icon"></i>
                  <span class="file-name" id="cv-file-name">Aucun fichier sélectionné</span>
                  <button type="button" class="remove-file" id="cv-remove-file">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
              <div class="real-file-input">
                {{ form.cv }}
              </div>
            </div>
            {% include "includes/field_errors.html" with field=form.cv %}
            <small class="form-text text-muted">
              Formats acceptés: PDF, DOC, DOCX. Taille max: 5MB
            </small>
          </div>

          <div class="form-group {% if form.photo.errors %}has-error{% endif %}">
            <label class="form-label" for="{{ form.photo.id_for_label }}">
              <i class="fas fa-camera"></i>
              Photo
            </label>
            <div class="file-upload-container">
              <div class="file-upload-box image-upload-box" id="photo-upload-box">
                <div class="image-preview" id="photo-preview">
                  <i class="fas fa-user-circle placeholder-icon"></i>
                </div>
                <div class="upload-text">
                  <span class="primary-text">Ajouter une photo</span>
                  <span class="secondary-text">JPG, PNG ou GIF</span>
                </div>
              </div>
              <div class="real-file-input">
                {{ form.photo }}
              </div>
            </div>
            {% include "includes/field_errors.html" with field=form.photo %}
            <small class="form-text text-muted">
              Formats acceptés: JPG, PNG, GIF. Taille max: 2MB
            </small>
          </div>
        </div>

        <div class="form-group {% if form.notes.errors %}has-error{% endif %}">
          <label class="form-label" for="{{ form.notes.id_for_label }}">
            <i class="fas fa-sticky-note"></i>
            Notes
          </label>
          {{ form.notes }}
          {% include "includes/field_errors.html" with field=form.notes %}
        </div>
      </div>

      <div class="form-navigation">
        <button type="button" class="btn btn-outline prev-step" data-prev="3">
          <i class="fas fa-arrow-left"></i>
          Précédent
        </button>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-save"></i>
          S'inscrire
        </button>
      </div>
    </div>
  </form>
</div>

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Gestion des étapes du formulaire
    const nextButtons = document.querySelectorAll('.next-step');
    const prevButtons = document.querySelectorAll('.prev-step');
    const steps = document.querySelectorAll('.form-step');
    const stepIndicators = document.querySelectorAll('.step');

    // Fonction pour valider les champs d'une étape
    function validateStep(stepNumber) {
      const currentStep = document.getElementById(`step-${stepNumber}`);
      const inputs = currentStep.querySelectorAll('input, select, textarea');
      let isValid = true;

      inputs.forEach(input => {
        if (input.hasAttribute('required') && !input.value) {
          isValid = false;
          input.classList.add('is-invalid');
        } else {
          input.classList.remove('is-invalid');
        }
      });

      return isValid;
    }

    // Fonction pour passer à l'étape suivante
    function goToNextStep(e) {
      const currentStepNumber = parseInt(e.target.dataset.next) - 1;
      const nextStepNumber = parseInt(e.target.dataset.next);
      
      if (validateStep(currentStepNumber)) {
        // Masquer l'étape actuelle
        steps.forEach(step => step.classList.remove('active'));
        document.getElementById(`step-${nextStepNumber}`).classList.add('active');
        
        // Mettre à jour les indicateurs d'étape
        stepIndicators.forEach((indicator, index) => {
          if (index < nextStepNumber) {
            indicator.classList.add('completed');
            indicator.classList.remove('active');
          } else if (index === nextStepNumber - 1) {
            indicator.classList.add('active');
          } else {
            indicator.classList.remove('active', 'completed');
          }
        });
      }
    }

    // Fonction pour revenir à l'étape précédente
    function goToPrevStep(e) {
      const prevStepNumber = parseInt(e.target.dataset.prev);
      
      // Masquer l'étape actuelle
      steps.forEach(step => step.classList.remove('active'));
      document.getElementById(`step-${prevStepNumber}`).classList.add('active');
      
      // Mettre à jour les indicateurs d'étape
      stepIndicators.forEach((indicator, index) => {
        if (index < prevStepNumber - 1) {
          indicator.classList.add('completed');
          indicator.classList.remove('active');
        } else if (index === prevStepNumber - 1) {
          indicator.classList.add('active');
        } else {
          indicator.classList.remove('active', 'completed');
        }
      });
    }

    // Ajouter les écouteurs d'événements
    nextButtons.forEach(button => {
      button.addEventListener('click', goToNextStep);
    });

    prevButtons.forEach(button => {
      button.addEventListener('click', goToPrevStep);
    });

    // Gestion des téléchargements de fichiers
    const cvInput = document.getElementById('{{ form.cv.id_for_label }}');
    const cvFileName = document.getElementById('cv-file-name');
    const cvFileInfo = document.getElementById('cv-file-info');
    const cvRemoveFile = document.getElementById('cv-remove-file');
    const cvUploadBox = document.getElementById('cv-upload-box');

    if (cvInput) {
      cvInput.addEventListener('change', function() {
        if (this.files.length > 0) {
          cvFileName.textContent = this.files[0].name;
          cvFileInfo.style.display = 'flex';
          cvUploadBox.classList.add('has-file');
        } else {
          cvFileInfo.style.display = 'none';
          cvUploadBox.classList.remove('has-file');
        }
      });

      cvRemoveFile.addEventListener('click', function() {
        cvInput.value = '';
        cvFileInfo.style.display = 'none';
        cvUploadBox.classList.remove('has-file');
      });

      cvUploadBox.addEventListener('click', function() {
        cvInput.click();
      });
    }

    // Gestion de l'aperçu de l'image
    const photoInput = document.getElementById('{{ form.photo.id_for_label }}');
    const photoPreview = document.getElementById('photo-preview');
    const photoUploadBox = document.getElementById('photo-upload-box');

    if (photoInput) {
      photoInput.addEventListener('change', function() {
        if (this.files.length > 0) {
          const file = this.files[0];
          const reader = new FileReader();
          
          reader.onload = function(e) {
            photoPreview.innerHTML = `<img src="${e.target.result}" alt="Aperçu de la photo">`;
            photoUploadBox.classList.add('has-image');
          };
          
          reader.readAsDataURL(file);
        } else {
          photoPreview.innerHTML = '<i class="fas fa-user-circle placeholder-icon"></i>';
          photoUploadBox.classList.remove('has-image');
        }
      });

      photoUploadBox.addEventListener('click', function() {
        photoInput.click();
      });
    }
  });
</script>
{% endblock %}
{% endblock content %} 