{% extends "base.html" %}
{% load static %}

{% block title %}{% if object.apprenant_id %}Modifier{% else %}Ajouter{% endif %} un Apprenant - Formatrix{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/apprenants/form.css' %}">
{% endblock %}

{% block content %}
<div class="form-container">
  <div class="form-header">
    <h1 class="form-title">
      <i class="fas {% if object.apprenant_id %}fa-edit{% else %}fa-user-plus{% endif %}"></i>
      {% if object.apprenant_id %}Modifier{% else %}Ajouter{% endif %} un Apprenant
    </h1>
    <a href="{% url 'apprenants:apprenant-list' %}" class="btn btn-secondary">
      <i class="fas fa-arrow-left"></i> Retour
    </a>
  </div>

  {% if messages %}
  <div>
    {% for message in messages %}
    <div class="alert {% if message.tags == 'error' %}alert-danger{% else %}alert-{{ message.tags }}{% endif %}">
      <i class="fas {% if message.tags == 'error' %}fa-exclamation-circle{% elif message.tags == 'success' %}fa-check-circle{% elif message.tags == 'info' %}fa-info-circle{% elif message.tags == 'warning' %}fa-exclamation-triangle{% endif %}"></i>
      {{ message }}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <p class="text-muted">Remplissez tous les champs obligatoires marqués d'un <span class="text-danger">*</span></p>

  {% if form.non_field_errors %}
  <div class="alert alert-danger">
    {% for error in form.non_field_errors %}
    {{ error }}
    {% endfor %}
  </div>
  {% endif %}

  <form method="post" novalidate>
    {% csrf_token %}
    
    <!-- Informations personnelles -->
    <div class="form-section">
      <h3 class="section-title">
        <i class="fas fa-user"></i>
        Informations personnelles
      </h3>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="{{ form.nom_apprenant.id_for_label }}">
            Nom de l'apprenant<span class="text-danger">*</span>
          </label>
          <input type="text" name="{{ form.nom_apprenant.html_name }}" id="{{ form.nom_apprenant.id_for_label }}" 
                 class="form-control {% if form.nom_apprenant.errors %}is-invalid{% endif %}" 
                 value="{{ form.nom_apprenant.value|default:'' }}" 
                 placeholder="Entrez le nom complet">
          {% if form.nom_apprenant.errors %}
          <div class="invalid-feedback">{{ form.nom_apprenant.errors.0 }}</div>
          {% endif %}
        </div>
        
        <div class="form-group">
          <label class="form-label" for="{{ form.autres_nom.id_for_label }}">
            Autres noms
          </label>
          <input type="text" name="{{ form.autres_nom.html_name }}" id="{{ form.autres_nom.id_for_label }}" 
                 class="form-control {% if form.autres_nom.errors %}is-invalid{% endif %}" 
                 value="{{ form.autres_nom.value|default:'' }}" 
                 placeholder="Autres noms (optionnel)">
          {% if form.autres_nom.errors %}
          <div class="invalid-feedback">{{ form.autres_nom.errors.0 }}</div>
          {% endif %}
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="{{ form.cin.id_for_label }}">
            Numéro CIN<span class="text-danger">*</span>
          </label>
          <input type="text" name="{{ form.cin.html_name }}" id="{{ form.cin.id_for_label }}" 
                 class="form-control {% if form.cin.errors %}is-invalid{% endif %}" 
                 value="{{ form.cin.value|default:'' }}" 
                 placeholder="Format: 000 000 000 000">
          {% if form.cin.errors %}
          <div class="invalid-feedback">{{ form.cin.errors.0 }}</div>
          {% endif %}
        </div>
        
        <div class="form-group">
          <label class="form-label" for="{{ form.date_naissance.id_for_label }}">
            Date de naissance<span class="text-danger">*</span>
          </label>
          <input type="date" name="{{ form.date_naissance.html_name }}" id="{{ form.date_naissance.id_for_label }}" 
                 class="form-control {% if form.date_naissance.errors %}is-invalid{% endif %}" 
                 value="{{ form.date_naissance.value|date:'Y-m-d'|default:'' }}">
          {% if form.date_naissance.errors %}
          <div class="invalid-feedback">{{ form.date_naissance.errors.0 }}</div>
          {% endif %}
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="{{ form.sexe.id_for_label }}">
            Genre<span class="text-danger">*</span>
          </label>
          <select name="{{ form.sexe.html_name }}" id="{{ form.sexe.id_for_label }}" 
                  class="form-control {% if form.sexe.errors %}is-invalid{% endif %}">
            <option value="" disabled {% if not form.sexe.value %}selected{% endif %}>Sélectionnez un genre</option>
            {% for option in form.sexe.field.choices %}
              <option value="{{ option.0 }}" {% if form.sexe.value == option.0 %}selected{% endif %}>{{ option.1 }}</option>
            {% endfor %}
          </select>
          {% if form.sexe.errors %}
          <div class="invalid-feedback">{{ form.sexe.errors.0 }}</div>
          {% endif %}
        </div>
        
        <div class="form-group">
          <label class="form-label" for="{{ form.categorie_age.id_for_label }}">
            Catégorie d'âge<span class="text-danger">*</span>
          </label>
          <select name="{{ form.categorie_age.html_name }}" id="{{ form.categorie_age.id_for_label }}" 
                  class="form-control {% if form.categorie_age.errors %}is-invalid{% endif %}">
            <option value="" disabled {% if not form.categorie_age.value %}selected{% endif %}>Sélectionnez une catégorie</option>
            {% for option in form.categorie_age.field.choices %}
              <option value="{{ option.0 }}" {% if form.categorie_age.value == option.0 %}selected{% endif %}>{{ option.1 }}</option>
            {% endfor %}
          </select>
          {% if form.categorie_age.errors %}
          <div class="invalid-feedback">{{ form.categorie_age.errors.0 }}</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Adresse -->
    <div class="form-section">
      <h3 class="section-title">
        <i class="fas fa-map-marker-alt"></i>
        Adresse
      </h3>
      
      <div class="form-group">
        <label class="form-label" for="{{ form.adresse_rue.id_for_label }}">
          Adresse (Rue)<span class="text-danger">*</span>
        </label>
        <input type="text" name="{{ form.adresse_rue.html_name }}" id="{{ form.adresse_rue.id_for_label }}" 
               class="form-control {% if form.adresse_rue.errors %}is-invalid{% endif %}" 
               value="{{ form.adresse_rue.value|default:'' }}" 
               placeholder="Numéro et nom de rue">
        {% if form.adresse_rue.errors %}
        <div class="invalid-feedback">{{ form.adresse_rue.errors.0 }}</div>
        {% endif %}
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="{{ form.localite.id_for_label }}">
            Localité<span class="text-danger">*</span>
          </label>
          <input type="text" name="{{ form.localite.html_name }}" id="{{ form.localite.id_for_label }}" 
                 class="form-control {% if form.localite.errors %}is-invalid{% endif %}" 
                 value="{{ form.localite.value|default:'' }}" 
                 placeholder="Quartier ou localité">
          {% if form.localite.errors %}
          <div class="invalid-feedback">{{ form.localite.errors.0 }}</div>
          {% endif %}
        </div>
        
        <div class="form-group">
          <label class="form-label" for="{{ form.ville.id_for_label }}">
            Ville<span class="text-danger">*</span>
          </label>
          <input type="text" name="{{ form.ville.html_name }}" id="{{ form.ville.id_for_label }}" 
                 class="form-control {% if form.ville.errors %}is-invalid{% endif %}" 
                 value="{{ form.ville.value|default:'' }}" 
                 placeholder="Nom de la ville">
          {% if form.ville.errors %}
          <div class="invalid-feedback">{{ form.ville.errors.0 }}</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Informations académiques -->
    <div class="form-section">
      <h3 class="section-title">
        <i class="fas fa-graduation-cap"></i>
        Informations académiques
      </h3>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="{{ form.niveau_academique.id_for_label }}">
            Niveau académique<span class="text-danger">*</span>
          </label>
          <select name="{{ form.niveau_academique.html_name }}" id="{{ form.niveau_academique.id_for_label }}" 
                  class="form-control {% if form.niveau_academique.errors %}is-invalid{% endif %}">
            <option value="" disabled {% if not form.niveau_academique.value %}selected{% endif %}>Sélectionnez un niveau</option>
            {% for option in form.niveau_academique.field.choices %}
              <option value="{{ option.0 }}" {% if form.niveau_academique.value == option.0 %}selected{% endif %}>{{ option.1 }}</option>
            {% endfor %}
          </select>
          {% if form.niveau_academique.errors %}
          <div class="invalid-feedback">{{ form.niveau_academique.errors.0 }}</div>
          {% endif %}
        </div>
        
        <div class="form-group">
          <label class="form-label" for="{{ form.type_apprenant.id_for_label }}">
            Type d'apprenant
          </label>
          <input type="text" name="{{ form.type_apprenant.html_name }}" id="{{ form.type_apprenant.id_for_label }}" 
                 class="form-control {% if form.type_apprenant.errors %}is-invalid{% endif %}" 
                 value="{{ form.type_apprenant.value|default:'' }}" 
                 placeholder="Ex: Étudiant, Professionnel, etc.">
          {% if form.type_apprenant.errors %}
          <div class="invalid-feedback">{{ form.type_apprenant.errors.0 }}</div>
          {% endif %}
        </div>
      </div>
      
      <div class="form-group">
        <label class="form-label" for="{{ form.besoins_speciaux.id_for_label }}">
          Besoins spéciaux
        </label>
        <textarea name="{{ form.besoins_speciaux.html_name }}" id="{{ form.besoins_speciaux.id_for_label }}" 
                  class="form-control {% if form.besoins_speciaux.errors %}is-invalid{% endif %}" 
                  placeholder="Précisez les besoins spéciaux si nécessaire">{{ form.besoins_speciaux.value|default:'' }}</textarea>
        {% if form.besoins_speciaux.errors %}
        <div class="invalid-feedback">{{ form.besoins_speciaux.errors.0 }}</div>
        {% endif %}
      </div>
    </div>

    <!-- Contact d'urgence -->
    <div class="form-section">
      <h3 class="section-title">
        <i class="fas fa-phone-alt"></i>
        Contact d'urgence
      </h3>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="{{ form.contact_urgence.id_for_label }}">
            Personne à contacter<span class="text-danger">*</span>
          </label>
          <input type="text" name="{{ form.contact_urgence.html_name }}" id="{{ form.contact_urgence.id_for_label }}" 
                 class="form-control {% if form.contact_urgence.errors %}is-invalid{% endif %}" 
                 value="{{ form.contact_urgence.value|default:'' }}" 
                 placeholder="Nom de la personne à contacter">
          {% if form.contact_urgence.errors %}
          <div class="invalid-feedback">{{ form.contact_urgence.errors.0 }}</div>
          {% endif %}
        </div>
        
        <div class="form-group">
          <label class="form-label" for="{{ form.telephone_urgence.id_for_label }}">
            Téléphone d'urgence<span class="text-danger">*</span>
          </label>
          <input type="tel" name="{{ form.telephone_urgence.html_name }}" id="{{ form.telephone_urgence.id_for_label }}" 
                 class="form-control {% if form.telephone_urgence.errors %}is-invalid{% endif %}" 
                 value="{{ form.telephone_urgence.value|default:'' }}" 
                 placeholder="Numéro de téléphone">
          {% if form.telephone_urgence.errors %}
          <div class="invalid-feedback">{{ form.telephone_urgence.errors.0 }}</div>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="form-actions">
      <a href="{% url 'apprenants:apprenant-list' %}" class="btn btn-secondary">
        <i class="fas fa-times"></i> Annuler
      </a>
      <button type="submit" class="btn btn-primary">
        <i class="fas {% if object.apprenant_id %}fa-save{% else %}fa-plus{% endif %}"></i>
        {% if object.apprenant_id %}Enregistrer{% else %}Ajouter{% endif %}
      </button>
    </div>
  </form>
</div>
{% endblock %}
