{% extends "base.html" %}
{% load static %}

{% block title %}{% if form.instance.pk %}Modifier{% else %}Créer{% endif %} une Séance - Formatrix{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/theme.css' %}">
<link rel="stylesheet" href="{% static 'css/forms.css' %}">
{% endblock %}

{% block content %}
<div class="form-container">
  <div class="form-header">
    <h2 class="form-title">
      <i class="fas {% if form.instance.pk %}fa-edit{% else %}fa-plus-circle{% endif %}"></i>
      {% if form.instance.pk %}Modifier{% else %}Créer{% endif %} une Séance
    </h2>
    <a href="{% url 'seance-list' %}" class="btn btn-outline">
      <i class="fas fa-arrow-left"></i>
      Retour
    </a>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div class="alert {% if message.tags == 'error' %}alert-danger{% else %}alert-{{ message.tags }}{% endif %} mb-4">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  {% if form.non_field_errors %}
    <div class="alert alert-danger">
      {% for error in form.non_field_errors %}
        {{ error }}
      {% endfor %}
    </div>
  {% endif %}

  <form method="post" novalidate>
    {% csrf_token %}
    <div class="form-grid">
      <!-- Lieu et Date -->
      <div class="form-section">
        <h3 class="section-title">
          <i class="fas fa-map-marker-alt"></i>
          Lieu et Date
        </h3>
        
        <div class="form-row">
          <div class="form-group {% if form.lieu.errors %}has-error{% endif %}">
            <label class="form-label" for="{{ form.lieu.id_for_label }}">
              <i class="fas fa-building"></i>
              Lieu
            </label>
            <div class="lieu-container">
              {{ form.lieu }}
              <a href="#" class="btn btn-primary btn-sm" id="openLieuModal">
                <i class="fas fa-plus"></i> Ajouter un lieu
              </a>
            </div>
            {% include "includes/field_errors.html" with field=form.lieu %}
          </div>

          <div class="form-group {% if form.date.errors %}has-error{% endif %}">
            <label class="form-label" for="{{ form.date.id_for_label }}">
              <i class="fas fa-calendar"></i>
              Date
            </label>
            {{ form.date }}
            {% include "includes/field_errors.html" with field=form.date %}
          </div>
        </div>
      </div>

      <!-- Cours -->
      <div class="form-section">
        <h3 class="section-title">
          <i class="fas fa-book"></i>
          Cours
        </h3>
        
        <div class="form-group {% if form.cours.errors %}has-error{% endif %}">
          <label class="form-label" for="{{ form.cours.id_for_label }}">
            <i class="fas fa-graduation-cap"></i>
            Sélectionner le cours
          </label>
          {{ form.cours }}
          {% include "includes/field_errors.html" with field=form.cours %}
        </div>
      </div>

      <!-- Capacité et Prix -->
      <div class="form-section">
        <h3 class="section-title">
          <i class="fas fa-users"></i>
          Capacité et Prix
        </h3>
        
        <div class="form-row">
          <div class="form-group {% if form.nombre_places.errors %}has-error{% endif %}">
            <label class="form-label" for="{{ form.nombre_places.id_for_label }}">
              <i class="fas fa-chair"></i>
              Nombre de places
            </label>
            {{ form.nombre_places }}
            {% include "includes/field_errors.html" with field=form.nombre_places %}
          </div>

          <div class="form-group {% if form.prix.errors %}has-error{% endif %}">
            <label class="form-label" for="{{ form.prix.id_for_label }}">
              <i class="fas fa-coins"></i>
              Prix
            </label>
            {{ form.prix }}
            {% include "includes/field_errors.html" with field=form.prix %}
          </div>
        </div>
      </div>

      <!-- Statut -->
      <div class="form-section">
        <h3 class="section-title">
          <i class="fas fa-flag"></i>
          Statut
        </h3>
        
        <div class="form-group {% if form.statut.errors %}has-error{% endif %}">
          <label class="form-label" for="{{ form.statut.id_for_label }}">
            <i class="fas fa-info-circle"></i>
            Statut de la séance
          </label>
          {{ form.statut }}
          {% include "includes/field_errors.html" with field=form.statut %}
        </div>
      </div>
    </div>

    <div class="form-actions">
      <a href="{% url 'seance-list' %}" class="btn btn-outline">
        <i class="fas fa-times"></i>
        Annuler
      </a>
      <button type="submit" class="btn btn-primary">
        <i class="fas {% if form.instance.pk %}fa-save{% else %}fa-plus{% endif %}"></i>
        {% if form.instance.pk %}Enregistrer les modifications{% else %}Créer{% endif %}
      </button>
    </div>
  </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize all form controls with Bootstrap classes
    const formControls = document.querySelectorAll('input, select, textarea');
    formControls.forEach(control => {
        control.classList.add('form-control');
    });

    // Gestion du bouton "Ajouter un lieu"
    const openModalBtn = document.getElementById('openLieuModal');
    
    openModalBtn.addEventListener('click', function(e) {
        e.preventDefault();
        // Récupérer l'URL actuelle
        const currentUrl = window.location.href;
        // Rediriger vers le formulaire de création de lieu avec l'URL de retour
        window.location.href = '/lieux/creer/?next=' + encodeURIComponent(currentUrl);
    });
});
</script>
{% endblock %} 